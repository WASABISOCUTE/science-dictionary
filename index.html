<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Science Dictionary</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

<h1>ğŸ“˜ ç†ç§‘è¯å…¸</h1>

<input id="search" placeholder="è¾“å…¥è‹±æ–‡ / ä¸­æ–‡ / å­¦ç§‘">

<!-- ä¸‹æ‹‰ç­›é€‰ -->
<div id="filter">
  <select id="subjectFilter">
    <option value="">å…¨éƒ¨ç§‘ç›®</option>
    <option value="Physics">Physics</option>
    <option value="Math">Math</option>
    <option value="Chemistry">Chemistry</option>
  </select>

  <select id="categoryFilter">
    <option value="">å…¨éƒ¨ç±»åˆ«</option>
    <option value="Scalar">Scalar</option>
    <option value="Vector">Vector</option>
    <option value="Function">Function</option>
    <option value="Theorem">Theorem</option>
    <option value="Substance">Substance</option>
  </select>

  <button id="clearFilter">æ¸…é™¤ç­›é€‰</button>
</div>

<div id="list"></div>

<!-- è¯¦æƒ…é¡µ -->
<div id="detail" style="display:none;">
  <button id="backBtn">â† è¿”å›</button>
  <h2 id="dEn"></h2>
  <p id="dCn"></p>
  <div id="dTags"></div>
  <p><strong>ç±»åˆ«:</strong> <span id="dCategory"></span></p>
  <p id="dUsage"></p>
  <p><strong>å…¬å¼:</strong> <span id="dFormula"></span></p>
  <div id="dSimilar"><strong>ç›¸å…³å•è¯:</strong></div>
</div>

<script src="data.js"></script>
<script>
const input = document.getElementById("search");
const list = document.getElementById("list");
const detail = document.getElementById("detail");
const backBtn = document.getElementById("backBtn");

const dEn = document.getElementById("dEn");
const dCn = document.getElementById("dCn");
const dTags = document.getElementById("dTags");
const dCategory = document.getElementById("dCategory");
const dUsage = document.getElementById("dUsage");
const dFormula = document.getElementById("dFormula");
const dSimilar = document.getElementById("dSimilar");

const subjectFilter = document.getElementById("subjectFilter");
const categoryFilter = document.getElementById("categoryFilter");
const clearFilter = document.getElementById("clearFilter");

// æ¸²æŸ“åˆ—è¡¨é¡µ
function render(items) {
  list.innerHTML = "";
  items.forEach(w => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <h2>${w.en}</h2>
      <p>${w.cn}</p>
      <div class="tags">
        ${(w.tags || []).map(t => `<span class="tag ${t}" data-tag="${t}">${t}</span>`).join("")}
      </div>
    `;
    div.addEventListener("click", () => showDetail(w));
    list.appendChild(div);
  });
}

// æ˜¾ç¤ºè¯¦æƒ…é¡µ
function showDetail(word) {
  list.style.display = "none";
  detail.style.display = "block";

  dEn.textContent = word.en;
  dCn.textContent = word.cn;
  dTags.innerHTML = (word.tags || []).map(t => `<span class="tag ${t}" data-tag="${t}">${t}</span>`).join("");
  dCategory.textContent = word.category || "";
  dUsage.textContent = word.usage || "";
  dFormula.innerHTML = word.formula ? `\\(${word.formula}\\)` : "æ— ";

  const similarList = word.similar || [];
  dSimilar.innerHTML = "<strong>ç›¸å…³å•è¯:</strong> ";
  if(similarList.length > 0){
    similarList.forEach(sim => {
      const simWord = words.find(w => w.en === sim);
      if(simWord){
        const btn = document.createElement("button");
        btn.textContent = simWord.en;
        btn.className = "tag";
        btn.addEventListener("click", () => showDetail(simWord));
        dSimilar.appendChild(btn);
      }
    });
  } else {
    dSimilar.innerHTML += "æ— ";
  }

  MathJax.typesetPromise(); // æ¸²æŸ“å…¬å¼
}

// è¿”å›åˆ—è¡¨é¡µ
backBtn.addEventListener("click", () => {
  detail.style.display = "none";
  list.style.display = "block";
});

// æœç´¢
input.addEventListener("input", () => {
  const q = input.value.toLowerCase();
  const result = words.filter(w =>
    w.en.toLowerCase().includes(q) ||
    w.cn.includes(q) ||
    (w.tags || []).join("").toLowerCase().includes(q)
  );
  render(result);
});

// äº‹ä»¶å§”æ‰˜æ ‡ç­¾ç‚¹å‡»ç­›é€‰
document.body.addEventListener("click", e => {
  if(e.target.classList.contains("tag") && e.target.dataset.tag) {
    const tag = e.target.dataset.tag;
    const result = words.filter(w => (w.tags || []).includes(tag));
    render(result);
    detail.style.display = "none";
    list.style.display = "block";
  }
});

// ä¸‹æ‹‰ç­›é€‰å‡½æ•°
function applyFilters() {
  const subject = subjectFilter.value;
  const category = categoryFilter.value;
  const filtered = words.filter(w => {
    const matchSubject = subject === "" || (w.tags || []).includes(subject);
    const matchCategory = category === "" || w.category === category;
    return matchSubject && matchCategory;
  });
  render(filtered);
  detail.style.display = "none";
  list.style.display = "block";
}

// ä¸‹æ‹‰ç­›é€‰äº‹ä»¶
subjectFilter.addEventListener("change", applyFilters);
categoryFilter.addEventListener("change", applyFilters);

// æ¸…é™¤ç­›é€‰æŒ‰é’®
clearFilter.addEventListener("click", () => {
  subjectFilter.value = "";
  categoryFilter.value = "";
  render(words);
});

// åˆå§‹æ¸²æŸ“
render(words);
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Science Dictionary</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

<h1>Science Dictionary</h1>

<input id="search" placeholder="Type English / Chinese / Subject">

<div id="filter">
  <select id="subjectFilter">
    <option value="">All Subject</option>
    <option value="Physics">Physics</option>
    <option value="Math">Math</option>
    <option value="Chemistry">Chemistry</option>
  </select>
  <select id="sortSelect">
  <option value="">Default</option>
  <option value="az">A â†’ Z</option>
  <option value="za">Z â†’ A</option>
  <option value="marked">Marked First</option>
</select>
  <button id="clearFilter">Clear Filter</button>
  <button id="showMarkedBtn">â­ Show Marked Words</button>
</div>

<div id="list"></div>

<!-- ===== è¯¦æƒ…é¡µ ===== -->
<div id="detail" style="display:none;">
  <button id="backBtn">â† Back</button>

  <h2>
  <span id="dEn"></span>
  <button id="pronounceBtn" title="Pronounce">ğŸ”Š</button>
  </h2>
  <p id="dCn"></p>
  <div id="dTags"></div>

  <p><strong>ç±»åˆ«:</strong> <span id="dCategory"></span></p>
  <p><strong>ä¸­æ–‡è§£é‡Š:</strong> <span id="dUsage"></span></p>
  <p><strong>English:</strong> <span id="dEnUsage"></span></p>
  <p><strong>å…¬å¼:</strong> <span id="dFormula"></span></p>
  <p><strong>ç¤ºä¾‹:</strong> <span id="dExample"></span></p>
  <!-- æ‰€å±åˆ†ç±» -->
  <p id="belongsBlock" class="detail-section"> <strong>æ‰€å±åˆ†ç±» / Belongs to:</strong> <span id="belongsList"></span></p>
  <p id="classificationBlock" class="detail-section"><strong>åˆ†ç±»:</strong> <span id="classificationList"></span></p>
  <p id="dSimilar"><strong>ç›¸å…³å•è¯:</strong></p>
  <button id="markDetailBtn">â˜† Mark</button>
  <button id="reportBtn">âš ï¸ æŠ¥å‘Šé”™è¯¯</button>
<!-- æ›´æ–°æ—¶é—´ -->
<div id="dUpdated" class="detail-updated"></div>

  <div id="reportForm" style="display:none;">
    <p>è¯·å¡«å†™æ­£ç¡®èµ„æ–™ï¼š</p>
    <textarea id="reportText" rows="4" placeholder="è¾“å…¥æ­£ç¡®çš„è‹±æ–‡ / ä¸­æ–‡ / å…¬å¼ / ç¤ºä¾‹ç­‰"></textarea>
    <button id="submitReport">æäº¤</button>
    <button id="cancelReport">å–æ¶ˆ</button>
  </div>
</div>

<!-- ===== ç½‘ç«™ä¿¡æ¯é¡µ ===== -->
<div id="about" style="display:none;">
  <button id="aboutBackBtn">â† Back</button>

  <h2>ç½‘ç«™ä¿¡æ¯ / Website Information</h2>

  <section class="about-section">
    <h3>é¡¹ç›®ç®€ä»‹ / About</h3>
    <p>ç†ç§‘è¯å…¸æ˜¯ä¸€ä¸ªé¢å‘ç†ç§‘é«˜ä¸­ç”Ÿçš„åœ¨çº¿å­¦ä¹ å·¥å…·ï¼Œç”¨äºå¿«é€ŸæŸ¥è¯¢ç‰©ç†ã€æ•°å­¦ã€åŒ–å­¦ç­‰ç§‘ç›®ä¸­çš„é‡è¦æœ¯è¯­ã€‚</p>
    <p>Science Dictionary is an online learning tool designed for high school science students, used for quickly looking up important terms in Physics, Mathematics, and Chemistry.</p>
  </section>

  <section class="about-section">
    <h3>åˆ¶ä½œäººå‘˜ / Credits</h3>
    <ul>
      <li><strong>é¡¹ç›®æ¦‚å¿µï¼š</strong> WASABISOCUTE</li>
      <li><strong>ç•Œé¢åŠåŠŸèƒ½è®¾è®¡ï¼š</strong> WASABISOCUTE</li>
      <li><strong>ä»£ç ï¼š</strong> ChatGPT</li>
    </ul>
    <ul>
      <li><strong>Project Concept:</strong> WASABISOCUTE</li>
      <li><strong>UI and Feature Design:</strong> WASABISOCUTE</li>
      <li><strong>Code Assistance:</strong> ChatGPT</li>
    </ul>
  </section>

  <section class="about-section">
    <h3>å¼€æºä¿¡æ¯ / Open Source</h3>
    <p>æœ¬é¡¹ç›®æ‰˜ç®¡äº GitHubï¼Œæ¬¢è¿æäº¤ Issue æˆ– Pull Requestã€‚</p>
    <p>This project is hosted on GitHub. Issues and Pull Requests are welcome.</p>
  </section>

  <section class="about-section">
    <h3>
      è´¡çŒ®è€… / Contributors
      <span class="info-icon" id="contributorsInfo">!</span>
    </h3>
    <div class="info-tooltip" id="contributorsTip">
      <p><strong>è¯´æ˜ï¼š</strong>è¯¥åŠŸèƒ½ä»åœ¨å¼€å‘ä¸­ï¼Œå¯èƒ½ä¸ä¼šæ˜¾ç¤ºæ‰€æœ‰è´¡çŒ®è€…ã€‚</p>
      <p><strong>Note:</strong> This feature is still under development and may not display all contributors.</p>
    </div>
    <ul id="contributors"><li>Loading...</li></ul>
  </section>

  <section class="about-section">
    <h3>è®¡åˆ’æ·»åŠ åŠŸèƒ½ / Planned Features</h3>
    <ul>
    <li><strong>å…¬å¼æŸ¥æ‰¾</strong></li>
    <li><strong>è®¾ç½®</strong></li>
    </ul>
  </section>
</div>

<footer id="footer">
  <span id="aboutLink">ç½‘ç«™ä¿¡æ¯</span>
</footer>

<script src="data.js"></script>
<script>
const input = document.getElementById("search");
const list = document.getElementById("list");
const detail = document.getElementById("detail");
const about = document.getElementById("about");

const backBtn = document.getElementById("backBtn");
const aboutBackBtn = document.getElementById("aboutBackBtn");
const aboutLink = document.getElementById("aboutLink");

const dEn = document.getElementById("dEn");
const dCn = document.getElementById("dCn");
const dTags = document.getElementById("dTags");
const dCategory = document.getElementById("dCategory");
const dUsage = document.getElementById("dUsage");
const dEnUsage = document.getElementById("dEnUsage");
const dFormula = document.getElementById("dFormula");
const dExample = document.getElementById("dExample");
const dSimilar = document.getElementById("dSimilar");
const belongsBlock = document.getElementById("belongsBlock");
const belongsList = document.getElementById("belongsList");
const classificationBlock = document.getElementById("classificationBlock");
const classificationList = document.getElementById("classificationList");

const sortSelect = document.getElementById("sortSelect");
const subjectFilter = document.getElementById("subjectFilter");
const clearFilter = document.getElementById("clearFilter");
const showMarkedBtn = document.getElementById("showMarkedBtn");

const dUpdated = document.getElementById("dUpdated");

const reportBtn = document.getElementById("reportBtn");
const reportForm = document.getElementById("reportForm");
const reportText = document.getElementById("reportText");
const submitReport = document.getElementById("submitReport");
const cancelReport = document.getElementById("cancelReport");

const markDetailBtn = document.getElementById("markDetailBtn");

let currentWord = null;
let markedWords = JSON.parse(localStorage.getItem("markedWords") || "[]");
let showingMarkedOnly = false;

/* ===== æ ‡è®°é€»è¾‘ ===== */
function updateMarkBtn(btn, en) { btn.textContent = markedWords.includes(en) ? "â˜…" : "â˜†"; }
function toggleMark(en) {
  if(markedWords.includes(en)) markedWords = markedWords.filter(w=>w!==en);
  else markedWords.push(en);
  localStorage.setItem("markedWords", JSON.stringify(markedWords));
}
function initMarkButtons(){
  document.querySelectorAll(".markBtn").forEach(btn=>{
    const en = btn.dataset.en;
    updateMarkBtn(btn, en);
    btn.onclick = e=>{
      e.stopPropagation();
      toggleMark(en);
      updateMarkBtn(btn, en);
    };
  });
}

/* ===== æ¸²æŸ“ ===== */
function render(items){
  list.innerHTML="";
  items.forEach(w=>{
    const div=document.createElement("div");
    div.className="card";
const parents = getParentCategories(w);

div.innerHTML = `
  <h2>${w.en} / ${w.cn}</h2>

  ${
    parents.length > 0
      ? `<div class="belongs-text">
           å±äºï¼š${parents.map(p => `${p.en}`).join(", ")}
         </div>`
      : ""
  }

  <div class="tags">
    ${(w.tags || []).map(t =>
      `<span class="tag ${t}" data-tag="${t}">${t}</span>`
    ).join("")}
  </div>

  <button class="markBtn" data-en="${w.en}">â˜†</button>
`;

    div.onclick=()=>showDetail(w);
    list.appendChild(div);
  });
  initMarkButtons();
}

/* ===== è¯¦æƒ…é¡µ ===== */
function showDetail(word){
  currentWord = word;
  list.style.display="none";
  about.style.display="none";
  detail.style.display="block";

  dEn.textContent = word.en;
  dCn.textContent = word.cn;
  dTags.innerHTML = (word.tags||[]).map(t=>`<span class="tag ${t}" data-tag="${t}">${t}</span>`).join("");
  dCategory.textContent = word.category||"";
  dUsage.textContent = word.usage||"";
  dEnUsage.textContent = word.enUsage||"";
  dFormula.innerHTML = word.formula?`\\(${word.formula}\\)`:"æ— ";
  dExample.textContent = word.example||"æ— ";

  dSimilar.innerHTML="<strong>ç›¸å…³å•è¯:</strong> ";
  (word.similar||[]).forEach(s=>{
    const sw=words.find(w=>w.en===s);
    if(sw){
      const b=document.createElement("button");
      b.textContent=sw.en;
      b.className="tag";
      b.onclick=()=>showDetail(sw);
      dSimilar.appendChild(b);
    }
  });
  if(!word.similar || word.similar.length===0) dSimilar.innerHTML+="æ— ";

const pronounceBtn = document.getElementById("pronounceBtn");

/*å‘éŸ³ */
function pronounceWord(text) {
  if (!window.speechSynthesis) return;

  speechSynthesis.cancel(); // åœæ­¢ä¸Šä¸€æ¬¡å‘éŸ³

  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "en-UK";
  utter.rate = 0.9;
  utter.pitch = 1;

  // ä¼˜å…ˆé€‰æ‹©è‹±æ–‡å£°éŸ³
  const voices = speechSynthesis.getVoices();
  const enVoice = voices.find(v => v.lang.startsWith("en"));
  if (enVoice) utter.voice = enVoice;

  speechSynthesis.speak(utter);
}

pronounceBtn.onclick = () => {
  if (currentWord) {
    pronounceWord(currentWord.en);
  }
};


  /* æ‰€å±åˆ†ç±» / Belongs to */
belongsList.innerHTML = "";

const parents = words.filter(w =>
  Array.isArray(w.classification) &&
  w.classification.some(c => c.en === word.en)
);

if (parents.length > 0) {
  belongsBlock.style.display = "block";

  parents.forEach(p => {
    const tag = document.createElement("span");
    tag.className = "tag";
    tag.textContent = `${p.en} / ${p.cn}`;

    tag.onclick = () => showDetail(p);

    belongsList.appendChild(tag);
  });
} else {
  belongsBlock.style.display = "none";
}

  /* åˆ†ç±» / Classification */
classificationList.innerHTML = "";

if (word.classification && word.classification.length > 0) {
  classificationBlock.style.display = "block";

  word.classification.forEach(item => {
    const btn = document.createElement("span");
    btn.className = "tag";
    btn.textContent = `${item.en} / ${item.cn}`;

    btn.onclick = () => {
      searchInput.value = item.en;
      renderList();
    };

    classificationList.appendChild(btn);
  });
} else {
  classificationBlock.style.display = "none";
}

  /* æ›´æ–°æ—¶é—´ */
if (word.updated) {
  dUpdated.textContent = `æ›´æ–°æ—¶é—´ / Last Updated: ${word.updated}`;
} else {
  dUpdated.textContent = "æ›´æ–°æ—¶é—´ / Last Updated: Unknown";
}

  updateMarkBtn(markDetailBtn, word.en);
  MathJax.typesetPromise();
}
/* ===== åˆ—è¡¨ä¸­å±äº ===== */
function getParentCategories(word) {
  return words.filter(w =>
    Array.isArray(w.classification) &&
    w.classification.some(c => c.en === word.en)
  );
}

/* ===== é¡µé¢åˆ‡æ¢ ===== */
backBtn.onclick=()=>{detail.style.display="none"; list.style.display="block";}
aboutLink.onclick=()=>{list.style.display="none"; detail.style.display="none"; about.style.display="block";}
aboutBackBtn.onclick=()=>{about.style.display="none"; list.style.display="block";}

/* ===== æœç´¢ & ç­›é€‰ ===== */
input.oninput=()=>{const q=input.value.toLowerCase(); render(words.filter(w=>w.en.toLowerCase().includes(q)||w.cn.includes(q)||(w.tags||[]).join("").toLowerCase().includes(q)));};
function applyFilters(){
  let result = words;
  if(subjectFilter.value) result = result.filter(w=>(w.tags||[]).includes(subjectFilter.value));
  if(showingMarkedOnly) result = result.filter(w=>markedWords.includes(w.en));
result = applySort(result);
render(result);
}
sortSelect.addEventListener("change", applyFilters);
subjectFilter.onchange = applyFilters;
clearFilter.onclick = ()=>{subjectFilter.value=""; showingMarkedOnly=false; showMarkedBtn.textContent="â­ Show Marked Words"; render(words);};
showMarkedBtn.onclick=()=>{showingMarkedOnly=!showingMarkedOnly; showMarkedBtn.textContent=showingMarkedOnly?"â­ Show All Words":"â­ Show Marked Words"; applyFilters();};
markDetailBtn.onclick=()=>{if(currentWord){toggleMark(currentWord.en); updateMarkBtn(markDetailBtn, currentWord.en);}};
/* ===== æ’åº ===== */
function applySort(list) {
  const mode = sortSelect.value;
  const arr = [...list];

  if (mode === "az") {
    arr.sort((a, b) => a.en.localeCompare(b.en));
  } 
  else if (mode === "za") {
    arr.sort((a, b) => b.en.localeCompare(a.en));
  } 
  else if (mode === "marked") {
    arr.sort((a, b) => {
      const aMarked = markedWords.includes(a.en);
      const bMarked = markedWords.includes(b.en);
      return bMarked - aMarked;
    });
  }

  return arr;
}
/* ===== æŠ¥é”™ ===== */
reportBtn.onclick=()=>reportForm.style.display="block";
cancelReport.onclick=()=>reportForm.style.display="none";
submitReport.onclick=()=>{
  if(currentWord && reportText.value.trim()){
    const repo="https://github.com/WASABISOCUTE/science-dictionary/issues/new";
    const title=encodeURIComponent(`Science Dictionary å•è¯æŠ¥é”™: ${currentWord.en}`);
    const body=encodeURIComponent(reportText.value);
    window.open(`${repo}?title=${title}&body=${body}`,"_blank");
    reportForm.style.display="none"; reportText.value="";
  }
};

/* ===== GitHub è´¡çŒ®è€… ===== */
const contributorsList = document.getElementById("contributors");
fetch("https://api.github.com/repos/WASABISOCUTE/science-dictionary/contributors")
.then(res=>res.json())
.then(data=>{
  contributorsList.innerHTML="";
  data.forEach(user=>{
    const li=document.createElement("li");
    li.innerHTML=`<a href="${user.html_url}" target="_blank" style="color:#60a5fa;">${user.login}</a> ï¼ˆ${user.contributions} commitsï¼‰`;
    contributorsList.appendChild(li);
  });
}).catch(()=>{contributorsList.innerHTML="<li>æ— æ³•åŠ è½½è´¡çŒ®è€…åˆ—è¡¨</li>";});

/* ===== tooltip ä¿®å¤ ===== */
const contributorsInfo = document.getElementById("contributorsInfo");
const contributorsTip = document.getElementById("contributorsTip");
let tipVisible = false;

// ç‚¹å‡»åˆ‡æ¢æ˜¾ç¤º
contributorsInfo.addEventListener("click", e => {
  e.stopPropagation(); 
  tipVisible = !tipVisible;
  contributorsTip.style.display = tipVisible ? "block" : "none";
});

// ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­ tooltip
document.addEventListener("click", () => {
  tipVisible = false;
  contributorsTip.style.display = "none";
});

/* ===== æ ‡ç­¾ç­›é€‰ ===== */
document.body.addEventListener("click", e=>{
  if(e.target.classList.contains("tag") && e.target.dataset.tag){
    const tag=e.target.dataset.tag;
    render(words.filter(w=>(w.tags||[]).includes(e.target.dataset.tag)));
    detail.style.display="none";
    list.style.display="block";
  }
});

render(words);
</script>
</body>
</html>
